# ADR-0003: 错误处理和恢复策略

**状态**: 已采用  
**日期**: 2025-12-01  
**决策者**: 架构团队

## 上下文

游戏引擎需要处理各种错误情况（资源加载失败、物理计算错误、渲染错误等），需要统一的错误处理策略。

## 决策

采用分层的错误处理策略：
- **领域层**: 使用 `DomainError` 枚举，包含领域特定错误
- **应用层**: 使用 `EngineError` 枚举，包含应用级错误
- **错误恢复**: 每个领域对象包含恢复策略（重试、使用默认值、跳过等）
- **错误聚合**: 记录错误统计，用于监控和调试

## 后果

### 优点
- **类型安全**: 使用枚举类型，编译时检查错误处理
- **可恢复性**: 支持错误恢复，提高系统健壮性
- **可观测性**: 错误统计帮助识别问题
- **一致性**: 统一的错误处理模式

### 缺点
- **代码量**: 需要定义更多错误类型
- **性能**: 错误处理可能增加一些开销（但影响很小）

### 实施细节
- 错误类型使用 `thiserror` 派生宏
- 领域错误位于 `src/domain/errors.rs`
- 核心错误位于 `src/core/error.rs`
- 使用 `Result<T, E>` 返回错误

## 替代方案

1. **panic**: 遇到错误直接panic
   - 拒绝原因: 不适合游戏引擎，需要优雅降级

2. **Option**: 使用 `Option<T>` 表示错误
   - 拒绝原因: 无法携带错误信息

3. **anyhow**: 使用动态错误类型
   - 部分采用: 在应用层可以使用，但领域层需要类型安全

## 相关决策

- ADR-0001: 使用领域驱动设计
- ADR-0002: 使用Actor模式进行并发控制



